<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkbox Behavior Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 8px;
        }
        .checkbox-group {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>Checkbox Behavior Test</h1>
    
    <div class="test-section">
        <h2>Test Case 1: Other Fruits (3 servings)</h2>
        <p>Scenario: All 3 boxes checked, click box 2 (should keep box 2 checked and uncheck box 3)</p>
        <div class="checkbox-group" id="test1">
            <div class="checkbox-item">
                <input type="checkbox" id="other-fruits-0" data-category="other-fruits" data-serving="0" class="serving-checkbox">
                <label for="other-fruits-0">1</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="other-fruits-1" data-category="other-fruits" data-serving="1" class="serving-checkbox">
                <label for="other-fruits-1">2</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="other-fruits-2" data-category="other-fruits" data-serving="2" class="serving-checkbox">
                <label for="other-fruits-2">3</label>
            </div>
        </div>
        <button onclick="setupTest1()">Setup Test 1</button>
        <button onclick="runTest1()">Run Test 1</button>
        <div id="result1" class="status"></div>
    </div>

    <div class="test-section">
        <h2>Test Case 2: Rightmost Checked Box</h2>
        <p>Scenario: Boxes 1 and 2 checked, click box 2 (rightmost)</p>
        <div class="checkbox-group" id="test2">
            <div class="checkbox-item">
                <input type="checkbox" id="other-fruits-0-2" data-category="other-fruits" data-serving="0" class="serving-checkbox">
                <label for="other-fruits-0-2">1</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="other-fruits-1-2" data-category="other-fruits" data-serving="1" class="serving-checkbox">
                <label for="other-fruits-1-2">2</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="other-fruits-2-2" data-category="other-fruits" data-serving="2" class="serving-checkbox">
                <label for="other-fruits-2-2">3</label>
            </div>
        </div>
        <button onclick="setupTest2()">Setup Test 2</button>
        <button onclick="runTest2()">Run Test 2</button>
        <div id="result2" class="status"></div>
    </div>

    <div class="test-section">
        <h2>Test Case 3: First Checked Box</h2>
        <p>Scenario: All 3 boxes checked, click box 1 (first checked box)</p>
        <div class="checkbox-group" id="test3">
            <div class="checkbox-item">
                <input type="checkbox" id="other-fruits-0-3" data-category="other-fruits" data-serving="0" class="serving-checkbox">
                <label for="other-fruits-0-3">1</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="other-fruits-1-3" data-category="other-fruits" data-serving="1" class="serving-checkbox">
                <label for="other-fruits-1-3">2</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="other-fruits-2-3" data-category="other-fruits" data-serving="2" class="serving-checkbox">
                <label for="other-fruits-2-3">3</label>
            </div>
        </div>
        <button onclick="setupTest3()">Setup Test 3</button>
        <button onclick="runTest3()">Run Test 3</button>
        <div id="result3" class="status"></div>
    </div>

    <div class="test-section">
        <h2>Test Case 4: Check Box with Boxes to Right</h2>
        <p>Scenario: Box 3 checked, then check box 1 (should uncheck box 1 and box 3)</p>
        <div class="checkbox-group" id="test4">
            <div class="checkbox-item">
                <input type="checkbox" id="other-fruits-0-4" data-category="other-fruits" data-serving="0" class="serving-checkbox">
                <label for="other-fruits-0-4">1</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="other-fruits-1-4" data-category="other-fruits" data-serving="1" class="serving-checkbox">
                <label for="other-fruits-1-4">2</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="other-fruits-2-4" data-category="other-fruits" data-serving="2" class="serving-checkbox">
                <label for="other-fruits-2-4">3</label>
            </div>
        </div>
        <button onclick="setupTest4()">Setup Test 4</button>
        <button onclick="runTest4()">Run Test 4</button>
        <div id="result4" class="status"></div>
    </div>

    <div class="test-section">
        <h2>Test Case 5: Single Checked Box</h2>
        <p>Scenario: Only box 1 checked, click box 1 (no boxes to the right)</p>
        <div class="checkbox-group" id="test5">
            <div class="checkbox-item">
                <input type="checkbox" id="other-fruits-0-5" data-category="other-fruits" data-serving="0" class="serving-checkbox">
                <label for="other-fruits-0-5">1</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="other-fruits-1-5" data-category="other-fruits" data-serving="1" class="serving-checkbox">
                <label for="other-fruits-1-5">2</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="other-fruits-2-5" data-category="other-fruits" data-serving="2" class="serving-checkbox">
                <label for="other-fruits-2-5">3</label>
            </div>
        </div>
        <button onclick="setupTest5()">Setup Test 5</button>
        <button onclick="runTest5()">Run Test 5</button>
        <div id="result5" class="status"></div>
    </div>

    <script>
        // Simplified version of the checkbox behavior logic
        class CheckboxTester {
            constructor() {
                this.categories = [
                    { id: 'other-fruits', servings: 3 }
                ];
            }

            handleServingChange(checkbox) {
                const categoryId = checkbox.dataset.category;
                const servingIndex = parseInt(checkbox.dataset.serving);
                const isChecked = checkbox.checked;

                if (isChecked) {
                    this.fillCheckboxesToLeft(categoryId, servingIndex);
                } else {
                    this.handleUncheckBehavior(categoryId, servingIndex, checkbox);
                }
            }

            fillCheckboxesToLeft(categoryId, servingIndex) {
                // Check if there are any checked boxes to the right of the current one
                const category = this.categories.find(c => c.id === categoryId);
                if (!category) return;
                
                let hasCheckedBoxesToRight = false;
                for (let i = servingIndex + 1; i < category.servings; i++) {
                    const rightCheckbox = document.getElementById(`${categoryId}-${i}`);
                    if (rightCheckbox && rightCheckbox.checked) {
                        hasCheckedBoxesToRight = true;
                        break;
                    }
                }
                
                if (hasCheckedBoxesToRight) {
                    // If there are checked boxes to the right, uncheck the clicked box and all to its right
                    this.uncheckBoxesToRight(categoryId, servingIndex);
                    // Also uncheck the clicked box itself
                    const clickedCheckbox = document.getElementById(`${categoryId}-${servingIndex}`);
                    if (clickedCheckbox) {
                        clickedCheckbox.checked = false;
                    }
                } else {
                    // Check all checkboxes to the left of the current one
                    for (let i = 0; i < servingIndex; i++) {
                        const leftCheckbox = document.getElementById(`${categoryId}-${i}`);
                        if (leftCheckbox && !leftCheckbox.checked) {
                            leftCheckbox.checked = true;
                        }
                    }
                }
            }

            handleUncheckBehavior(categoryId, servingIndex, checkbox) {
                const category = this.categories.find(c => c.id === categoryId);
                if (!category) return;
                
                let leftmostCheckedIndex = -1;
                let rightmostCheckedIndex = -1;
                
                // Find leftmost checked box
                for (let i = 0; i < category.servings; i++) {
                    const currentCheckbox = document.getElementById(`${categoryId}-${i}`);
                    if (currentCheckbox && currentCheckbox.checked) {
                        leftmostCheckedIndex = i;
                        break;
                    }
                }
                
                // Find rightmost checked box
                for (let i = category.servings - 1; i >= 0; i--) {
                    const currentCheckbox = document.getElementById(`${categoryId}-${i}`);
                    if (currentCheckbox && currentCheckbox.checked) {
                        rightmostCheckedIndex = i;
                        break;
                    }
                }
                
                // If the clicked checkbox is the leftmost checked one, uncheck all boxes
                if (servingIndex === leftmostCheckedIndex) {
                    this.uncheckAllBoxes(categoryId);
                }
                // If the clicked checkbox is the rightmost checked one, uncheck it and all to the left
                else if (servingIndex === rightmostCheckedIndex) {
                    this.uncheckBoxesToLeft(categoryId, servingIndex);
                } else {
                    // Check if there are any checked boxes to the right of the clicked box
                    let hasCheckedBoxesToRight = false;
                    for (let i = servingIndex + 1; i < category.servings; i++) {
                        const rightCheckbox = document.getElementById(`${categoryId}-${i}`);
                        if (rightCheckbox && rightCheckbox.checked) {
                            hasCheckedBoxesToRight = true;
                            break;
                        }
                    }
                    
                    if (hasCheckedBoxesToRight) {
                        // Re-check the clicked box and uncheck only the boxes to its right
                        checkbox.checked = true;
                        this.uncheckBoxesToRight(categoryId, servingIndex);
                    }
                    // If no checked boxes to the right, leave the clicked box unchecked
                }
            }

            uncheckBoxesToLeft(categoryId, servingIndex) {
                // Uncheck all checkboxes to the left of the current one AND the current one
                for (let i = 0; i <= servingIndex; i++) {
                    const leftCheckbox = document.getElementById(`${categoryId}-${i}`);
                    if (leftCheckbox && leftCheckbox.checked) {
                        leftCheckbox.checked = false;
                    }
                }
            }

            uncheckBoxesToRight(categoryId, servingIndex) {
                const category = this.categories.find(c => c.id === categoryId);
                if (!category) return;
                
                for (let i = servingIndex + 1; i < category.servings; i++) {
                    const rightCheckbox = document.getElementById(`${categoryId}-${i}`);
                    if (rightCheckbox && rightCheckbox.checked) {
                        rightCheckbox.checked = false;
                    }
                }
            }

            uncheckAllBoxes(categoryId) {
                // Uncheck all checkboxes in the category
                const category = this.categories.find(c => c.id === categoryId);
                if (!category) return;
                
                for (let i = 0; i < category.servings; i++) {
                    const checkbox = document.getElementById(`${categoryId}-${i}`);
                    if (checkbox && checkbox.checked) {
                        checkbox.checked = false;
                    }
                }
            }
        }

        const tester = new CheckboxTester();

        // Setup event listeners
        document.addEventListener('change', (e) => {
            if (e.target.classList.contains('serving-checkbox')) {
                tester.handleServingChange(e.target);
            }
        });

        function setupTest1() {
            // Check all 3 boxes
            document.getElementById('other-fruits-0').checked = true;
            document.getElementById('other-fruits-1').checked = true;
            document.getElementById('other-fruits-2').checked = true;
            document.getElementById('result1').innerHTML = '<div class="success">Setup: All 3 boxes checked</div>';
        }

        function runTest1() {
            // Click box 2 (should keep box 2 checked and uncheck box 3)
            const checkbox2 = document.getElementById('other-fruits-1');
            checkbox2.checked = false;
            tester.handleServingChange(checkbox2);
            
            const box1 = document.getElementById('other-fruits-0').checked;
            const box2 = document.getElementById('other-fruits-1').checked;
            const box3 = document.getElementById('other-fruits-2').checked;
            
            if (box1 && box2 && !box3) {
                document.getElementById('result1').innerHTML = '<div class="success">✅ Test 1 PASSED: Boxes 1 and 2 remain checked, box 3 unchecked</div>';
            } else {
                document.getElementById('result1').innerHTML = `<div class="error">❌ Test 1 FAILED: Box 1=${box1}, Box 2=${box2}, Box 3=${box3}</div>`;
            }
        }

        function setupTest2() {
            // Check boxes 1 and 2
            document.getElementById('other-fruits-0-2').checked = true;
            document.getElementById('other-fruits-1-2').checked = true;
            document.getElementById('other-fruits-2-2').checked = false;
            document.getElementById('result2').innerHTML = '<div class="success">Setup: Boxes 1 and 2 checked</div>';
        }

        function runTest2() {
            // Click box 2 (rightmost checked, should uncheck both)
            const checkbox2 = document.getElementById('other-fruits-1-2');
            checkbox2.checked = false;
            tester.handleServingChange(checkbox2);
            
            const box1 = document.getElementById('other-fruits-0-2').checked;
            const box2 = document.getElementById('other-fruits-1-2').checked;
            const box3 = document.getElementById('other-fruits-2-2').checked;
            
            if (!box1 && !box2 && !box3) {
                document.getElementById('result2').innerHTML = '<div class="success">✅ Test 2 PASSED: All boxes unchecked</div>';
            } else {
                document.getElementById('result2').innerHTML = `<div class="error">❌ Test 2 FAILED: Box 1=${box1}, Box 2=${box2}, Box 3=${box3}</div>`;
            }
        }

        function setupTest3() {
            // Check all 3 boxes
            document.getElementById('other-fruits-0-3').checked = true;
            document.getElementById('other-fruits-1-3').checked = true;
            document.getElementById('other-fruits-2-3').checked = true;
            document.getElementById('result3').innerHTML = '<div class="success">Setup: All 3 boxes checked</div>';
        }

        function runTest3() {
            // Click box 1 (first checked box, should uncheck all)
            const checkbox1 = document.getElementById('other-fruits-0-3');
            checkbox1.checked = false;
            tester.handleServingChange(checkbox1);
            
            const box1 = document.getElementById('other-fruits-0-3').checked;
            const box2 = document.getElementById('other-fruits-1-3').checked;
            const box3 = document.getElementById('other-fruits-2-3').checked;
            
            if (!box1 && !box2 && !box3) {
                document.getElementById('result3').innerHTML = '<div class="success">✅ Test 3 PASSED: All boxes unchecked</div>';
            } else {
                document.getElementById('result3').innerHTML = `<div class="error">❌ Test 3 FAILED: Box 1=${box1}, Box 2=${box2}, Box 3=${box3}</div>`;
            }
        }

        function setupTest4() {
            // Check only box 3
            document.getElementById('other-fruits-0-4').checked = false;
            document.getElementById('other-fruits-1-4').checked = false;
            document.getElementById('other-fruits-2-4').checked = true;
            document.getElementById('result4').innerHTML = '<div class="success">Setup: Only box 3 checked</div>';
        }

        function runTest4() {
            // Check box 1 (should uncheck box 1 and box 3)
            const checkbox1 = document.getElementById('other-fruits-0-4');
            checkbox1.checked = true;
            tester.handleServingChange(checkbox1);
            
            const box1 = document.getElementById('other-fruits-0-4').checked;
            const box2 = document.getElementById('other-fruits-1-4').checked;
            const box3 = document.getElementById('other-fruits-2-4').checked;
            
            if (!box1 && !box2 && !box3) {
                document.getElementById('result4').innerHTML = '<div class="success">✅ Test 4 PASSED: Box 1 and box 3 unchecked</div>';
            } else {
                document.getElementById('result4').innerHTML = `<div class="error">❌ Test 4 FAILED: Box 1=${box1}, Box 2=${box2}, Box 3=${box3}</div>`;
            }
        }

        function setupTest5() {
            // Check only box 1
            document.getElementById('other-fruits-0-5').checked = true;
            document.getElementById('other-fruits-1-5').checked = false;
            document.getElementById('other-fruits-2-5').checked = false;
            document.getElementById('result5').innerHTML = '<div class="success">Setup: Only box 1 checked</div>';
        }

        function runTest5() {
            // Click box 1 (first checked box, should uncheck all)
            const checkbox1 = document.getElementById('other-fruits-0-5');
            checkbox1.checked = false;
            tester.handleServingChange(checkbox1);
            
            const box1 = document.getElementById('other-fruits-0-5').checked;
            const box2 = document.getElementById('other-fruits-1-5').checked;
            const box3 = document.getElementById('other-fruits-2-5').checked;
            
            if (!box1 && !box2 && !box3) {
                document.getElementById('result5').innerHTML = '<div class="success">✅ Test 5 PASSED: All boxes unchecked</div>';
            } else {
                document.getElementById('result5').innerHTML = `<div class="error">❌ Test 5 FAILED: Box 1=${box1}, Box 2=${box2}, Box 3=${box3}</div>`;
            }
        }
    </script>
</body>
</html>
